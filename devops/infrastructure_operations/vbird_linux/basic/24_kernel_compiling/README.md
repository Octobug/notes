# 第二十四章 核心编译

> <https://linux.vbird.org/linux_basic/centos7/0540kernel.php>

## 目录

- [第二十四章 核心编译](#第二十四章-核心编译)
  - [目录](#目录)
  - [24.1 编译前的任务：认识内核与取得内核源代码](#241-编译前的任务认识内核与取得内核源代码)
    - [24.1.1 什么是内核（Kernel）](#2411-什么是内核kernel)
    - [24.1.2 更新内核的目的](#2412-更新内核的目的)
    - [24.1.3 内核的版本](#2413-内核的版本)
    - [24.1.4 内核源代码的获取方式](#2414-内核源代码的获取方式)
    - [24.1.5 内核源代码的解压缩/安装/观察](#2415-内核源代码的解压缩安装观察)
  - [24.2 内核编译的前处理与内核功能选择](#242-内核编译的前处理与内核功能选择)

## 24.1 编译前的任务：认识内核与取得内核源代码

### 24.1.1 什么是内核（Kernel）

- Kernel: 管理硬件的软件，包含驱动硬件的检测程序与驱动模块
  - 内核文件通常为 `/boot/vmlinuz-xxx`
- 内核模块（Kernel module）的用途：动态载入模块，而不需要变动内核
  - 内核模块通常在 `/lib/modules/$(uname -r)/kernel/` 中
- 自制内核 - 内核编译
- 关于驱动程序 - 是厂商的责任还是内核的责任？
  - 是硬件尝试的责任

### 24.1.2 更新内核的目的

- Linux 内核特色，与默认内核对终端用户的角色
- 内核编译的可能目的
  - 新功能需求
  - 原本的内核太过臃肿
  - 与硬件搭配的稳定性
  - 其他需求，如嵌入式系统

### 24.1.3 内核的版本

很多软件会依赖某些版本内核的功能，升级内核会导致这部分软件用不了。因此最好只在某个 LTS
版本内升级。

### 24.1.4 内核源代码的获取方式

- distribution 提供的内核源代码文件
  - CentOS: <http://vault.centos.org/>
- 获取最新的稳定版内核源代码
  - 内核官网: <https://www.kernel.org/>
- 保留原本设置：利用 patch 升级内核源代码
  - patch 必须要连续

### 24.1.5 内核源代码的解压缩/安装/观察

- 内核源代码的解压与放置目录: `/usr/src/kernels`
- 内核源代码下的次目录
  - arch: 硬件架构
  - block: 与块设备相关的设置数据
  - crypto: 支持的加密技术
  - documentation: 说明文档
  - drivers: 硬件驱动
  - firmware: 旧式硬件的固件
  - fs: 支持的文件系统
  - include: 可以让其他程序调用的 header 文件
  - init: 内核初始化的定义功能，包括挂载与 init 进程的调用等
  - ipc: 定义 Linux 系统内进程间通信
  - kernel: 定义内核的进程、内核状态、线程、进程调度、进程信号等
  - lib: 函数库
  - mm: 与内存有关的数据
  - net: 与网络有关的数据
  - security: 包括 selinux 等在内的安全设置
  - sound: 与音效相关的模块
  - virt: 与虚拟化相关的信息，如 KVM (Kernel base Virtual Machine)

## 24.2 内核编译的前处理与内核功能选择

>>>>> progress

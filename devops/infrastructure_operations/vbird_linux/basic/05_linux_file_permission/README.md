# 第五章 Linux 文件权限与目录配置

> <https://linux.vbird.org/linux_basic/centos7/0210filepermission.php>

- [第五章 Linux 文件权限与目录配置](#第五章-linux-文件权限与目录配置)
  - [5.1 使用者与群组](#51-使用者与群组)
  - [5.2 Linux 文件权限概念](#52-linux-文件权限概念)
    - [5.2.1 Linux 文件属性](#521-linux-文件属性)
    - [5.2.2 如何改变文件属性与权限](#522-如何改变文件属性与权限)
    - [5.2.3 目录与文件之权限意义](#523-目录与文件之权限意义)
    - [5.2.4 Linux 文件种类与扩展名](#524-linux-文件种类与扩展名)
  - [5.3 Linux 目录配置](#53-linux-目录配置)
    - [5.3.1 Linux 目录配置的依据 -- FHS](#531-linux-目录配置的依据----fhs)
    - [5.3.2 目录树 (directory tree)](#532-目录树-directory-tree)
    - [5.3.3 绝对路径与相对路径](#533-绝对路径与相对路径)
    - [5.3.4 CentOS 的观察](#534-centos-的观察)
  - [5.4 重点回顾](#54-重点回顾)
  - [5.5 本章练习](#55-本章练习)
  - [5.6 参考资料与延伸阅读](#56-参考资料与延伸阅读)

## 5.1 使用者与群组

1. 文件拥有者
2. 群组概念
3. 其他人的概念

## 5.2 Linux 文件权限概念

### 5.2.1 Linux 文件属性

list: `ls -al`

```sh
# 类型与权限   属主      文件大小              文件名
-rw-r--r-- 1 root root  3796 Jan 11 03:24 .zshrc
#        链接数    属组         最后修改时间
```

1. 文件类型与权限:
    1. 文件类型
        - `[d]`: 目录
        - `[-]`: 文件
        - `[l]`: 链接文件
        - `[b]`: 块设备
        - `[c]`: 字符设备
    2. 三组 `rwx` 分别代表: 1. 属主的权限; 2. 属组的权限; 3. 其他用户的权限
        - `r`: read
        - `w`: write
        - `x`: execute
2. 链接到此 i-node 的文件数: 每个文件都会将其权限与属性记录到文件系统的 `i-node` 中
3. 文件属主名称
4. 文件属组名称
5. 文件大小，单位为 Bytes
6. 最近修改日期 (ls 的 `--full-time` 参数可显示完整日期)
7. 文件名

### 5.2.2 如何改变文件属性与权限

- `chgrp`: change group, 改变文件所属群组
- `chown`: change owner, 改变文件拥有者
- `chmod`: 改变文件权限, `SUID`/`SGID`/`SBIT` 等属性
  - 使用数字: r:4, w:2, x:1
  - 使用符号:

    ```sh
    chmod | u, g, o, a | +, -, = | r, w, x, <留空> | 文件

    # 例:
    chmod 755 filename
    # 逗号后不能有空格
    chmod u=rwx,go=rx filename
    ```

!`cp` 会复制**执行者**的属性与权限。

### 5.2.3 目录与文件之权限意义

- 权限对文件的重要性: `rwx` 是针对文件内容而言，而非文件的存在与否。
- 权限对目录的重要性: 目录主要内容为记录文件名清单
  - r: read contents in directory
    - 如使用 `ls`
  - w: modify contents of directory
    - 创建新文件与目录
    - 删除文件与目录 (无论文件的权限是什么)
    - 重命名文件或目录
  - x: access directory

| 类型 | 内容     | r            | w            | x                |
| ---- | -------- | ------------ | ------------ | ---------------- |
| 文件 | 详细数据 | 读取文件内容 | 修改文件内容 | 执行文件内容     |
| 目录 | 文件名   | 读取文件名   | 修改文件名   | 进入该目录的权限 |

例: 对于目录权限，有没有 r 权限的区别

- 有 r: 可列举目录内容

  ```sh
  ls: cannot access '/tmp/testing/testing': Permission denied
  total 0
  -????????? ? ? ? ?            ? testing
  ```

- 无 r: 无法列举目录内容

  ```sh
  ls -l /tmp/testing         
  ls: cannot open directory '/tmp/testing': Permission denied
  ```

### 5.2.4 Linux 文件种类与扩展名

- 文件种类
  - `-`: regular file, 普通文件
    - 文本文件 (text)
    - 二进制文件 (binary)
    - 数据格式文件 (data): 特定格式文件
  - `d`: directory, 目录
  - `l`: link, 链接
  - 设备文件
    - `b`: block, 块设备，可随机存取的周边设备，一般是存储设备
    - `c`: character, 字符设备，串行周边设备
  - `s`: sockets，数据接口文件
  - `p`: pipe, FIFO
- 文件扩展名: Linux 中没有所谓的扩展名，`.ext` 这种形式只是 convention
- 文件名限制
  - 单一文件或目录的最大文件名: 255Bytes, 即 255 个 ASCII 字符
  - 字符集: 不能用 ?><;&![]|\'"`(){}

## 5.3 Linux 目录配置

### 5.3.1 Linux 目录配置的依据 -- FHS

直接参考 [FHS 3.0](../../fhs)。

- 可分享的：可以分享给其他系统挂载使用的目录，包括可执行文件与使用者的邮件等数据，
  是能够分享给网络上其他主机挂载用的目录；
- 不可分享的：自己机器上允许的设备文件或是与程序有关的 socket 文件等，由于仅与自身机器有关，
  所以不适合分享给其他主机；
- 不变的：有些数据不会经常变动，跟随着发行版而不变。如函数库、文件、说明文档、
  系统管理员管理的主机服务配置文件等；
- 可变的：经常改变的数据，例如登录日志、系统及进程的运行数据等。

FHS 针对目录树架构定义出三个目录下应该放置什么数据：

- `/`: 与开机系统相关；
- `/usr` (unix software resource): 与软件安装/执行相关；
- `/var` (variable): 与系统运行过程相关；

详解：

- 根目录 `/` 的意义与内容：其他目录都由此衍生，同时根目录也和开机/还原/修复等动作相关。
  系统开机需要特定的软件、内核文件、函数库文件等数据，系统出现错误时根目录必须包含能修复系统的
  程序。
  
  FHS 建议：根目录分区越小越好，且软件、数据不要和根目录放在同一分区。

  FHS 定义根目录下应该有以下目录：

  | Part 1: 必须目录 | 内容                                            |
  | ---------------- | ----------------------------------------------- |
  | /bin             | 所有用户使用的命令                              |
  | /boot            | Linux 内核文件, loader, 开机配置文件等          |
  | /dev             | 设备文件及特殊文件                              |
  | /etc             | 系统主要配置文件                                |
  | /lib             | 系统、程序的函数库，`/lib/modules` 放置内核模块 |
  | /media           | 可移除的媒体文件，软盘、光盘常挂载于此          |
  | /mnt             | 额外设备临时挂载点                              |
  | /opt             | 第三方附加软件                                  |
  | /run             | 系统运行的数据文件                              |
  | /sbin            | 系统、管理员使用的程序及命令。                  |
  | /srv             | 网络服务使用的数据目录                          |
  | /tmp             | 临时文件目录，FHS 建议系统开机时自动清空        |
  | /usr             | user system resources                           |
  | /var             | 放置变化的数据                                  |
  | Part 2: 建议目录 |                                                 |
  | /home            | 用户主目录                                      |
  | `/lib<qual>`     | 例如 /lib64                                     |
  | /root            | root home 目录                                  |

  其他非 FHS 规定的常见目录：

  | 其他目录    | 内容                                                        |
  | ----------- | ----------------------------------------------------------- |
  | /lost+found | ext2/3/4 文件系统产生的目录，发生错误时遗失的片段会放置在此 |
  | /proc       | 虚拟文件系统，存在于内存，存放内核、进程信息                |
  | /sys        | 虚拟文件系统，存在于内存，存放内核与硬件相关的信息          |

- `/usr` 的意义与内容：可分享(给其他主机)且不可变

  | Part 1: 必须目录 | 内容                                                 |
  | ---------------- | ---------------------------------------------------- |
  | /usr/bin         | 用户能使用的命令都在这里, 有些发行版将 /bin 链接于此 |
  | /usr/lib         | 有些发行版将 /lib 链接于此                           |
  | /usr/local       | 管理员为本机安装的软件                               |
  | /usr/sbin        | 有些发行版将 /sbin 链接于此                          |
  | /usr/share       | 不分架构的只读共享文件                               |
  | Part 2: 建议目录 |                                                      |
  | /usr/games       | 游戏数据文件                                         |
  | /usr/include     | 头文件                                               |
  | /usr/libexec     | 不被一般用户使用的命令或脚本                         |
  | `/usr/lib<qual>` | 有些发行版将 `/lib<qual>` 链接于此                   |
  | /usr/src         | 核心源码                                             |

- `/var` 的意义与内容：变化的数据文件，如缓存、日志、进程文件

  | Part 1: 必须目录 | 内容                                   |
  | ---------------- | -------------------------------------- |
  | /var/cache       | 缓存文件                               |
  | /var/lib         | 程序执行过程使用的库文件               |
  | /var/lock        | 锁文件，由 Debian 引入变动为 /run/lock |
  | /var/log         | 日志文件                               |
  | /var/mail        | 用户邮件                               |
  | /var/run         | PID 等进程数据                         |
  | /var/spool       | 待处理数据                             |

- 针对 FHS，各家发行版的差异
  - /bin --> /usr/bin
  - /sbin --> /usr/sbin
  - /lib --> /usr/lib
  - /lib64 --> /usr/lib64
  - /var/lock --> /run/lock
  - /var/run --> /run

### 5.3.2 目录树 (directory tree)

- 目录树的起始点为 `/`
- 每一个目录可以使用本地磁盘分区的文件系统，也可以使用网络文件系统，比如使用 NFS (Network
  File System) 挂载特定目录
- 每一个文件的文件名 (完整路径) 都是独一无二的

### 5.3.3 绝对路径与相对路径

- 绝对 (absolute) 路径: 从 `/` 开始写起的文件路径
- 相对 (relative) 路径: 相对于当前路径的文件路径

### 5.3.4 CentOS 的观察

LSB (Linux Standard Base): <https://wiki.linuxfoundation.org/lsb/start>

- `lsb_release`: 已经不是默认安装命令
- `uname`

## 5.4 重点回顾

- 需要 root 权限时可以使用 `su -` 切换身份
- FHS 的主要目的是希望使用者可以了解到已安装软件通常放置于哪个目录下
- FHS 按目录数据特性将目录分为四种：
  - shareable
  - unshareable
  - static
  - variable
- FHS 定义的三层主目录为
  - /
  - /var
  - /usr

## 5.5 本章练习

1. 对于权限为 777 的文件，任何人都可读写执行，但不一定能删除。

## 5.6 参考资料与延伸阅读

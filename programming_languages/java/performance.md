# Performance

- [Performance](#performance)
  - [基本类型与引用类型](#基本类型与引用类型)
    - [Java 中的 8 种内置类型](#java-中的-8-种内置类型)
      - [基本类型的存储方式](#基本类型的存储方式)
    - [引用类型](#引用类型)
      - [引用类型的存储方式](#引用类型的存储方式)
    - [堆和栈的性能差异](#堆和栈的性能差异)
    - [为什么这么设计](#为什么这么设计)
      - [这种设计的弊端](#这种设计的弊端)
  - [Garbage Collection](#garbage-collection)

## 基本类型与引用类型

### Java 中的 8 种内置类型

- boolean
- char
- byte
- short
- int
- long
- float
- double

#### 基本类型的存储方式

在函数中创建一个基本类型的变量时，比如：

```java
int n = 123;
```

变量 `n` 的值也是存储在栈（Stack）上的，这个语句不需要再从堆中申请内存。

### 引用类型

引用类型则是那些可以通过 `new` 来创建对象的类型（基本上都派生自 Object）。

#### 引用类型的存储方式

在函数中创建一个引用类型的对象时，比如：

```java
StringBuffer str = new StringBuffer();
```

该 `StringBuffer` 对象的内容是存储在堆（Heap）上的，需要申请堆内存。而变量 `str`
只不过是针对该 `StringBuffer` 对象的一个引用（或者叫地址）。

变量 `str` 的值（也就是 `StringBuffer` 对象的地址）是存储在栈上的。

### 堆和栈的性能差异

- 堆相对进程来说是全局的，能够被所有线程访问；
- 栈是线程局部的，只能本线程访问。

由于堆是所有线程共有的，从堆里面申请内存要进行相关的加锁操作，因此申请堆内存的复杂度和时间开销比栈要大很多；

从栈里面申请内存，虽然又简单又快，但是栈的大小有限，分配不了太多内存。

### 为什么这么设计

如果把各种东西都放置到栈中，显然不现实。一来栈是线程私有的（不便于共享），二来栈的大小是有限的，三来栈的结构也间接限制了它的用途。

那为什么不把所有东西都放置到堆里面？申请堆内存要办很多手续，太繁琐，影响性能。

把类型分为“基本类型”和“引用类型”，两者使用不同的创建方式。这种差异从 Java 语法上也可以看出来：
引用类型总是用 `new` 创建对象（某些单键对象/单例对象，表面上没用 `new`，但是在
`getInstance()` 内部也还是用 `new` 创建的）；而基本类型则不需要用 `new` 创建。

#### 这种设计的弊端

- 由于基本类型不是派生自 Object，因此不能算是纯对象。
- 由于基本类型不是派生自 Object，出于某些场合（比如容器类）的考虑，不得不为每个基本类型加上对应的包装类（比如 Integer、Byte 等），使得语言变得有点冗余。

使用 `new` 创建对象的开销是不小的。在程序中能避免就应该尽量避免。
另外，使用 `new` 创建对象，不光是创建时开销大，将来垃圾回收销毁对象也是有开销的。

## Garbage Collection

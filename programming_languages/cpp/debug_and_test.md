# 调试与测试

- [调试与测试](#调试与测试)
  - [多线程](#多线程)
    - [设置断点与单步执行](#设置断点与单步执行)
    - [Log 输出](#log-输出)
      - [传统 Log 机制的问题](#传统-log-机制的问题)
      - [Log 函数要尽量简短](#log-函数要尽量简短)

## 多线程

### 设置断点与单步执行

多线程造成的主要问题大多数和条件竞争有关。
设置断电或单步执行会干扰多个进程之间的竞争状态，导致难以复现。

### Log 输出

#### 传统 Log 机制的问题

对于 C++ 而言，标准库内置的类和函数 `cout`, `printf` `fput` 等可能有线程安全的问题。
尤其是标准流类库的八个全局对象。

由于这个原因，多线程最好用第三方线程库自带的 log 机制，比如 ACE 的 `ACE_Log_Msg`。

#### Log 函数要尽量简短

通常会包装一个公用的 log 函数，在其内部调用线程库的 log 函数。为了不影响多线程的条件竞争，这个公用 log 函数应尽量简短，避免操作一些全局变量。
